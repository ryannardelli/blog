<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/css/sidebar.css">
</head>

<body>

    {{> sidebar}}

    <main class="main">
        <div class="topbar">
            <div class="toggle">
                <ion-icon name="menu-outline"></ion-icon>
            </div>
            <!-- Search -->
            <div class="search">
                <label>
                    <input type="text" name="search" id="search" placeholder="Pesquise aqui">
                    <ion-icon name="search-outline"></ion-icon>
                </label>
            </div>
            <!-- UserImg -->
            <div class="user">
                <img src="{{user.profile_picture}}" alt="{{user.name}}">
            </div>
        </div>
        {{{body}}}
        <div class="results"></div>
    </main>

    <script>

        // Menu toggle
        let toggle = document.querySelector('.toggle');
        let navigation = document.querySelector('.navigation');
        let main = document.querySelector('.main');
        toggle.addEventListener('click', () => {
            navigation.classList.toggle('active');
            main.classList.toggle('active');
        });

        // search User
        document.querySelector('#search').addEventListener('input', async function () {
            const searchQuery = this.value;
            console.log(searchQuery);

            if (searchQuery.length > 0) {
                try {
                    const response = await fetch(`http://localhost:3000/dashboard/search?search=${searchQuery}`);
                    const result = await response.json();
                    console.log(result);
                    displayResults(result);
                } catch (e) {
                    console.log('Erro ao fazer a requisição: ', e)
                }
            } else {
                document.querySelector('.results').innerHTML = '';
            }
        })

        function displayResults(users) {
    const resultsContainer = document.querySelector('.results');
    
    if (!resultsContainer) {
        console.error('Elemento de resultados não encontrado.');
        return;
    }

    // Limpar resultados anteriores
    resultsContainer.innerHTML = '';

    if (users.length === 0) {
        resultsContainer.innerHTML = '<p>Nenhum usuário encontrado.</p>';
        return;
    }

    const userList = document.createElement('ul');
    users.forEach(user => {
        const userItem = document.createElement('li');
        userItem.textContent = user.name;  // Exibe o nome do usuário
        userList.appendChild(userItem);
    });

    resultsContainer.appendChild(userList);
}

    </script>
</body>

</html>